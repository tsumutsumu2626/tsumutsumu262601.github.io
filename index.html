<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã©ã£ã¡ã®ã»ã†ãŒå‰µé€ æ€§ã‚ã‚‹ï¼Ÿãƒ©ãƒ³ã‚­ãƒ³ã‚°å®Ÿé¨“</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 20px;
      text-align: center;
    }
    h1 {
      margin-bottom: 0.2em;
    }
    #topInfo {
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
    }
    #description {
      font-size: 14px;
      color: #444;
      margin-bottom: 16px;
    }
    .images {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    .image-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 320px;
    }
    .image-wrapper img {
      max-width: 100%;
      max-height: 320px;
      border: 3px solid transparent;
      cursor: pointer;
      box-sizing: border-box;
    }
    .image-wrapper img:hover {
      border-color: #888;
    }
    .filename {
      font-size: 12px;
      margin-top: 4px;
      color: #555;
      word-break: break-all;
    }
    #status {
      margin-top: 10px;
      font-size: 13px;
      color: #555;
    }
    button {
      padding: 6px 14px;
      margin: 4px;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      font-size: 13px;
      background: #f6f6f6;
    }
    button:hover {
      background: #e9e9e9;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    #resultArea {
      margin-top: 24px;
      text-align: left;
      max-width: 700px;
      margin-inline: auto;
      font-size: 13px;
      white-space: pre-wrap;
      border-top: 1px solid #ddd;
      padding-top: 12px;
      max-height: 400px;
      overflow-y: auto; /* ä¸‹ã¾ã§å…¨éƒ¨è¦‹ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
    }
    #pairCount {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ã©ã£ã¡ã®ã»ã†ãŒå‰µé€ æ€§ã‚ã‚‹ï¼Ÿ</h1>

  <!-- ã‚¢ã‚¯ã‚»ã‚¹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼è¡¨ç¤º -->
  <div id="topInfo">
    ã‚¢ã‚¯ã‚»ã‚¹æ•°ï¼š<span id="accessCount">èª­ã¿è¾¼ã¿ä¸­â€¦</span>
  </div>

  <div id="description">
    å·¦å³ã©ã¡ã‚‰ã‹ã€Œå‰µé€ æ€§ãŒã‚ã‚‹ã€ã¨æ€ã†ç”»åƒã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã­ã€‚<br>
    ã¿ã‚“ãªã®é¸æŠã§ã€ä¸‹ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆæœ€ä¸Šä½ã€œæœ€ä¸‹ä½ï¼‰ãŒå°‘ã—ãšã¤å¤‰ã‚ã£ã¦ã„ãã¾ã™ã€‚
  </div>

  <div class="images">
    <div class="image-wrapper">
      <img id="leftImg" alt="å·¦ã®ç”»åƒ">
      <div class="filename" id="leftName"></div>
    </div>
    <div class="image-wrapper">
      <img id="rightImg" alt="å³ã®ç”»åƒ">
      <div class="filename" id="rightName"></div>
    </div>
  </div>

  <div id="status">
    ç”»åƒæšæ•°ï¼š<span id="imageCount">0</span>æš /
    æ¯”è¼ƒå›æ•°ï¼š<span id="pairCount">0</span> å›
    <button id="refreshRankingBtn">ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°</button>
  </div>

  <div id="resultArea"></div>

  <script>
    // ===== ã‚¢ã‚¯ã‚»ã‚¹ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆCountAPIï¼‰ =====
    (function setupAccessCounter() {
      const namespace = "kaname-creativity-test"; // å¥½ããªè‹±æ•°å­—ã«å¤‰ãˆã¦OK
      const key = "access-counter";

      fetch(`https://api.countapi.xyz/hit/${namespace}/${key}`)
        .then(res => res.json())
        .then(data => {
          document.getElementById("accessCount").textContent = data.value;
        })
        .catch(() => {
          document.getElementById("accessCount").textContent = "å–å¾—å¤±æ•—";
        });
    })();
  </script>

  <script>
    // ===== å‰µé€ æ€§ãƒãƒˆãƒ«æœ¬ä½“ =====

    // â˜… images.json ã®ä¸­èº«ã‚’ãã®ã¾ã¾ã“ã“ã«è²¼ã‚‹ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜å¯¾å¿œç‰ˆï¼‰
    const images = [
     "images/(1).png",
     "images/(2).png",
     "images/(3).png",
     "images/(4).png",
     "images/(5).png",
     "images/(6).png",
     "images/(7).png",
     "images/(8).png",
     "images/(9).png",
     "images/(10).png",
     "images/(11).png",
     "images/(12).png",
     "images/(13).png",
     "images/(14).png",
     "images/(15).png",
     "images/(16).png",
     "images/(17).png",
     "images/(18).png",
     "images/(19).png",
     "images/(20).png",
     "images/(21).png",
     "images/(22).png",
     "images/(23).png",
     "images/(24).png",
     "images/(25).png",
     "images/(26).png",
     "images/(27).png",
     "images/(28).png",
     "images/(29).png",
     "images/(30).png",
     "images/(31).png",
     "images/(32).png",
     "images/(33).png",
     "images/(34).png",
     "images/(35).png",
     "images/(36).png",
     "images/(37).png",
     "images/(38).png",
     "images/(39).png",
     "images/(40).png",
     "images/(41).png",
     "images/(42).png",
     "images/(43).png",
     "images/(44).png",
     "images/(45).png",
     "images/(46).png",
     "images/(47).png",
     "images/(48).png",
     "images/(49).png",
     "images/(50).png",
     "images/(51).png",
     "images/(52).png",
     "images/(53).png",
     "images/(54).png",
     "images/(55).png",
     "images/(56).png",
     "images/(57).png",
     "images/(58).png",
     "images/(59).png",
     "images/(60).png",
     "images/(61).png",
     "images/(62).png",
     "images/(63).png",
     "images/(64).png",
     "images/(65).png",
     "images/(66).png",
     "images/(67).png",
     "images/(68).png",
     "images/(69).png",
     "images/(70).png",
     "images/(71).png",
     "images/(72).png",
     "images/(73).png",
     "images/(74).png",
     "images/(75).png",
     "images/(76).png",
     "images/(77).png",
     "images/(78).png",
     "images/(79).png",
     "images/(80).png",
     "images/(81).png",
     "images/(82).png",
     "images/(83).png"
    ];

    const scores = {};
    let leftIndex = null;
    let rightIndex = null;
    let pairCount = 0;

    // â˜… æ¯”è¼ƒå›æ•°ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚­ãƒ¼
    const PAIR_COUNT_KEY = "creative_pairCount";

    const leftImg = document.getElementById("leftImg");
    const rightImg = document.getElementById("rightImg");
    const leftName = document.getElementById("leftName");
    const rightName = document.getElementById("rightName");
    const imageCountSpan = document.getElementById("imageCount");
    const pairCountSpan = document.getElementById("pairCount");
    const resultArea = document.getElementById("resultArea");
    const refreshRankingBtn = document.getElementById("refreshRankingBtn");

    function init() {
      if (!Array.isArray(images) || images.length < 2) {
        alert("images é…åˆ—ã«ç”»åƒãƒ‘ã‚¹ã‚’2ã¤ä»¥ä¸Šå…¥ã‚Œã¦ãã ã•ã„ã€‚");
        return;
      }

      for (let i = 0; i < images.length; i++) {
        scores[i] = {
          rating: 1000,
          wins: 0,
          losses: 0,
          shown: 0
        };
      }

      imageCountSpan.textContent = images.length.toString();

      // ğŸ”½ å‰å›ã¾ã§ã®æ¯”è¼ƒå›æ•°ã‚’ localStorage ã‹ã‚‰èª­ã¿è¾¼ã‚€
      const savedCount = localStorage.getItem(PAIR_COUNT_KEY);
      if (savedCount !== null) {
        pairCount = Number(savedCount) || 0;
      } else {
        pairCount = 0;
      }
      pairCountSpan.textContent = pairCount.toString();

      pickTwoDifferent();
      updateRankingView();
    }

    // 2ã¤ã®ç•°ãªã‚‹ç”»åƒã‚’é¸ã¶
    function pickTwoDifferent() {
      if (images.length < 2) return;

      let a = Math.floor(Math.random() * images.length);
      let b;
      do {
        b = Math.floor(Math.random() * images.length);
      } while (a === b);

      leftIndex = a;
      rightIndex = b;

      leftImg.src = images[leftIndex];
      rightImg.src = images[rightIndex];

      leftName.textContent = images[leftIndex].split("/").pop();
      rightName.textContent = images[rightIndex].split("/").pop();

      scores[leftIndex].shown++;
      scores[rightIndex].shown++;
    }

    // Eloãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ›´æ–°
    function updateElo(winnerIndex, loserIndex, k = 16) {
      const winner = scores[winnerIndex];
      const loser = scores[loserIndex];

      const Ra = winner.rating;
      const Rb = loser.rating;

      const Ea = 1 / (1 + Math.pow(10, (Rb - Ra) / 400));
      const Eb = 1 / (1 + Math.pow(10, (Ra - Rb) / 400));

      winner.rating = Ra + k * (1 - Ea);
      loser.rating = Rb + k * (0 - Eb);

      winner.wins++;
      loser.losses++;
    }

    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
    function updateRankingView() {
      const arr = Object.entries(scores).map(([idx, obj]) => ({
        index: Number(idx),
        rating: obj.rating,
        wins: obj.wins,
        losses: obj.losses,
        shown: obj.shown
      }));

      arr.sort((a, b) => b.rating - a.rating);

      let text = "â—† å‰µé€ æ€§ã‚¹ã‚³ã‚¢ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆæœ€ä¸Šä½ â†’ æœ€ä¸‹ä½ï¼‰\n";
      text += "é †ä½ | ãƒ¬ãƒ¼ãƒˆ | å‹ã¡-è² ã‘ | è¡¨ç¤ºå›æ•° | ãƒ•ã‚¡ã‚¤ãƒ«å\n";
      text += "----------------------------------------------------------\n";

      arr.forEach((item, i) => {
        const filename = images[item.index].split("/").pop();
        text += `${String(i + 1).padStart(2, " ")}ä½ | `
             + `${item.rating.toFixed(1).padStart(6, " ")} | `
             + `${String(item.wins).padStart(2, " ")}-${String(item.losses).padStart(2, " ")} | `
             + `${String(item.shown).padStart(3, " ")}å› | `
             + `${filename}\n`;
      });

      resultArea.textContent = text;
    }

    leftImg.addEventListener("click", () => {
      if (leftIndex === null || rightIndex === null) return;
      updateElo(leftIndex, rightIndex);
      pairCount++;
      pairCountSpan.textContent = pairCount.toString();
      // ğŸ”½ ã‚¯ãƒªãƒƒã‚¯ã®ãŸã³ã«æ¯”è¼ƒå›æ•°ã‚’ä¿å­˜
      localStorage.setItem(PAIR_COUNT_KEY, pairCount.toString());
      pickTwoDifferent();
      updateRankingView();
    });

    rightImg.addEventListener("click", () => {
      if (leftIndex === null || rightIndex === null) return;
      updateElo(rightIndex, leftIndex);
      pairCount++;
      pairCountSpan.textContent = pairCount.toString();
      // ğŸ”½ ã‚¯ãƒªãƒƒã‚¯ã®ãŸã³ã«æ¯”è¼ƒå›æ•°ã‚’ä¿å­˜
      localStorage.setItem(PAIR_COUNT_KEY, pairCount.toString());
      pickTwoDifferent();
      updateRankingView();
    });

    refreshRankingBtn.addEventListener("click", () => {
      updateRankingView();
    });

    window.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
